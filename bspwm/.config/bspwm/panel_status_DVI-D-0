#! /bin/sh

source $(dirname $0)/panel_config

datetime() {
    echo "%{F#FF$WHITE_COLOR}date %{F}$(date +'%A, %b %d')  %{B#FF$RED_COLOR}  $(date +'%H:%M')  %{B-}"
}

temperature() {
    CPU_TEMP=$(sensors | grep "Core 0" | cut -d+ -f2 | cut -d. -f1)
    echo "%{F#FF$WHITE_COLOR}temp %{F}$CPU_TEMPÂ°C"
}

load_avg() {
    AVGLOAD=$(cut -d " " -f 1-3 /proc/loadavg)
    echo "%{F#FF$WHITE_COLOR}load %{F}$AVGLOAD"
}

syncthing() {
    SYNC_STATUS=$(systemctl status syncthing@mfin | grep active | cut -d: -f 2 | cut -d " " -f 2)
    echo "%{F#FF$WHITE_COLOR}sync %{F}$SYNC_STATUS"
}

diskspace() {
    SPACE_AVAIL=$(df -h $1 | tail -1 | sed 's/ \+ / /g' | cut -d " " -f 4)
    DISK_NAME=$(df -h $1 | tail -1 | cut -d " " -f 1 | cut -d "/" -f 4)
    echo "%{F#FF$WHITE_COLOR}$DISK_NAME %{F}$SPACE_AVAIL"
}

mpd(){
    STATUS=$(mpc current)
    if [ "$STATUS" != "" ]; then
        echo "%{F#FF$WHITE_COLOR A:mpc toggle: A3:mpc stop:}mpd %{F}$STATUS%{A A}"
    else echo ""
    fi
}

while :; do
    echo "S$(mpd)%{r}$(diskspace "/dev/mapper/main-home") $SEP $(syncthing) $SEP $(temperature) $SEP $(load_avg) $SEP $(datetime)"
    sleep 2
done
