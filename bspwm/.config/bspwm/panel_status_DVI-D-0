#! /bin/sh

source $(dirname $0)/panel_config

datetime() {
    echo "%{F#FF$WHITE_COLOR}date %{F}$(date +'%A, %b %d')  %{B#FF$RED_COLOR}  $(date +'%H:%M')  %{B-}"
}

temperature() {
    CPU_TEMP=$(sensors | grep "Core 0" | cut -d+ -f2 | cut -d. -f1)
    echo "%{F#FF$WHITE_COLOR}temp %{F}$CPU_TEMPÂ°C"
}

load_avg() {
    AVGLOAD=$(cut -d " " -f 1-3 /proc/loadavg)
    echo "%{F#FF$WHITE_COLOR}load %{F}$AVGLOAD"
}

mpd(){
    STATUS=$(mpc current)
    if [ "$STATUS" != "" ]; then
        DONE_PERCENTAGE=$(expr $(mpc | grep playing | cut -d "(" -f 2 | sed 's/%)//g') / 10)
        TEN_PERC="$(printf '%b' "\u2796")"
        PROGRESS_BAR=""
        for (( i = 0; i < 10; i++ )); do
            MPC_SKIP=$(expr $i*10)
            if [ $i -lt $DONE_PERCENTAGE ]; then
                PROGRESS_BAR="$PROGRESS_BAR$TEN_PERC"
            else PROGRESS_BAR="$PROGRESS_BAR%{F#FF$BLACK2_COLOR}$TEN_PERC%{F-}"
            fi
        done
        echo "%{F#FF$WHITE_COLOR A:mpc toggle: A3:mpc stop:}$(printf '%b' "\u266a") %{F}$STATUS%{A A} $PROGRESS_BAR"
    else echo ""
    fi
}

while :; do
    echo "S$(mpd)%{r}$(temperature) $SEP $(load_avg) $SEP $(datetime)"
    sleep 2
done
